{{ define "main" }}
<main id="site-main">
    <div class="main-content">
        {{ range .Params.page_sections }}
        {{ partial (printf "blocks/block-%s.html" .block) (dict "Section" . "Page" $) }} {{ end }}
    </div>
    <div class="bg-gray-100 py-12">
        <div class="container w-full max-w-screen-xl mx-auto lg:px-16 mb-8">
            <div class="posts grid grid-cols-1 lg:grid-cols-3 gap-8 px-4 lg:px-0 mb-8 {{ if $.IsHome }}post-flex{{ else }}feed__wrapper{{ end }}">
                {{ $paginator := .Paginate (where .Site.RegularPages "Type" "in" .Site.Params.mainSections) }}

                {{ if gt $paginator.TotalPages 0 }}
                {{ range $index, $page := $paginator.Pages }}
                <article
                    class="{{ if and $.IsHome (eq $paginator.PageNumber 1) (eq $index 0) }}first-entry{{ else }}post-entry{{ end }} feed col-span-1 rounded-sm">
                    <div class="bg-white shadow-md rounded-sm">
                        <div class="relative pt-3-2">
                            <a class="feed__link" href="{{ .Permalink }}">
                                {{ if .Params.thumbnail }}
                                <img class="lazyload blur-up absolute top-0 left-0 w-full h-full" alt="{{ .Title }}"
                                    data-src="{{ .Params.thumbnail | relURL }}" width="420" height="380" />
                                {{ end }}
                            </a>
                        </div>
                        <div class="pt-4 pb-6 px-4">
                            {{ $baseUrl := .Site.BaseURL }} {{ range first 1 .Params.categories }}
                            <a class="text-xs text-gray-500 uppercase hover:no-underline"
                                href="{{ $baseUrl }}{{ . | urlize }}">{{ . }}</a>{{ end }}

                            <h3 class="feed__title text-base"><a
                                    class="text-gray-700 hover:text-secondary hover:no-underline"
                                    href="{{ .Permalink}}">{{ .Title }}</a>
                            </h3>

                            {{ if not $.IsHome }}
                            <div class="feed__meta">
                                {{ $baseUrl := .Site.BaseURL }} {{ range first 1 .Params.authors }}
                                {{ with ($.Site.GetPage (printf "/%s" "authors")) }}
                                {{ range .Pages }}
                                <img src="{{ .Params.avatar }}" class="feed__avatar" alt="{{ .Title }}">
                                {{ end }}
                                {{ end }}
                                <a class="feed__author" href="{{ $baseUrl }}{{ . | urlize }}">{{ . }}</a>{{ end }}
                                <time class="feed__published"> -
                                    {{ with .Site.Params.dateFormat }}{{ $.Date.Format . }}{{ else }}{{ .Date.Format "02 January 2006" }}{{ end }}</time>
                            </div>
                            <section class="feed__content">
                                <p>{{ .Summary | plainify | htmlUnescape }}...</p>
                            </section>
                            {{ end }}
                        </div>
                    </div>
                </article>
                {{ end }}
                {{ end }}
                
            </div>
            {{ partial "pagination.html" . }}
        </div>
    </div>
</main>
{{ end }}